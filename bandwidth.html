<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Tenda Router - Connected Devices</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
/* === همان CSS شما بدون تغییر === */
:root {
  --primary: #3498db;
  --secondary: #f26522;
  --success: #2ecc71;
  --warning: #f39c12;
  --danger: #e74c3c;
  --dark: #2c3e50;
  --light: #ecf0f1;
  --gray: #95a5a6;
  --text-dark: #2c3e50;
  --text-light: #f9f9f9;
  --border-light: #ddd;
  --border-dark: #555;
  --card-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
  --transition: all 0.3s ease;
}
/* باقی CSS بدون تغییر ... */
</style>
</head>
<body data-theme="light">

<header>
  <div class="title">
    <i class="fas fa-wifi"></i>
    <span>Tenda Router</span>
  </div>
  <div class="controls">
    <div class="theme-toggle" id="menuThemeToggle">
      <i class="fas fa-moon"></i>
    </div>
    <div class="menu-toggle" id="menuToggleBtn">
      <i class="fas fa-bars"></i>
    </div>
  </div>
</header>

<nav id="mainMenu">
    <ul>
        <li><a href="status.html"><i class="fas fa-chart-bar"></i> Status</a></li>
        <li><a href="Internet.html"><i class="fas fa-globe"></i> Internet</a></li>
        <li><a href="wireless.html"><i class="fas fa-wifi"></i> Wireless</a></li>
        <li><a href="bandwidth.html"><i class="fas fa-tachometer-alt"></i> Bandwidth</a></li> 
        <li><a href="repeating.html"><i class="fas fa-retweet"></i> Repeating</a></li>
        <li><a href="prantal.html"><i class="fas fa-user-shield"></i> Parental</a></li>
        <li><a href="advanced.html"><i class="fas fa-cogs"></i> Advanced</a></li>
        <li><a href="security.html"><i class="fas fa-shield-alt"></i> Security</a></li>
        <li><a href="admin.html"><i class="fas fa-user-cog"></i> Admin</a></li>
    </ul>
</nav>

<div class="container">
  <div class="device-count fade-in" id="deviceCount">
    <i class="fas fa-laptop"></i>
    <span>Total Connected Devices: 12</span>
  </div>

  <div class="box fade-in" id="connectedBox">
    <h3><i class="fas fa-network-wired"></i> Connected Devices</h3>
    <div id="connectedDevices"></div>
  </div>

  <div class="box fade-in" id="blockedBox">
    <h3><i class="fas fa-ban"></i> Blocked Devices</h3>
    <div id="blockedDevices"></div>
  </div>
</div>

<script>
/* === همان JS شما بدون تغییر با اضافه کردن ارسال به PHP برای تلگرام === */
const connectedDevicesEl = document.getElementById("connectedDevices");
const blockedDevicesEl = document.getElementById("blockedDevices");
const deviceCountEl = document.getElementById("deviceCount");
const menuToggleBtn = document.getElementById("menuToggleBtn");
const mainMenu = document.getElementById("mainMenu");
const themeToggle = document.getElementById('menuThemeToggle');
const themeIcon = themeToggle.querySelector('i');
const body = document.body;
const savedTheme = localStorage.getItem('siteTheme');

if(savedTheme){
  body.setAttribute('data-theme', savedTheme);
  themeIcon.className = savedTheme === 'light' ? 'fas fa-moon' : 'fas fa-sun';
}

themeToggle.addEventListener('click', () => {
  const current = body.getAttribute('data-theme') || 'light';
  const next = current === 'light' ? 'dark' : 'light';
  body.setAttribute('data-theme', next);
  themeIcon.className = next === 'light' ? 'fas fa-moon' : 'fas fa-sun';
  localStorage.setItem('siteTheme', next);
});

menuToggleBtn.addEventListener("click", () => {
  mainMenu.classList.toggle("active");
  document.body.style.overflow = mainMenu.classList.contains('active') ? 'hidden' : '';
});

function randomIP(){ 
  return `${Math.floor(Math.random()*256)}.${Math.floor(Math.random()*256)}.${Math.floor(Math.random()*256)}.${Math.floor(Math.random()*256)}`; 
}
function randomUsage(){ 
  const b = Math.floor(Math.random()*(2000-200+1)+200); 
  return b < 1000 ? b + " KB" : (b/1000).toFixed(2) + " MB"; 
}
function randomSpeed(){ 
  return `${Math.floor(Math.random()*100)+1} Mbps`; 
}
function getDeviceIcon(deviceName) {
  if (deviceName.includes('IPHONE') || deviceName.includes('IPHOEN')) return 'mobile-alt';
  if (deviceName.includes('SAMSUNG')) return 'mobile';
  if (deviceName.includes('LG')) return 'mobile';
  if (deviceName.includes('HAWAWI')) return 'mobile';
  if (deviceName.includes('INFINIX')) return 'mobile';
  return 'laptop';
}

let connectedDevices = [
  {name:"IPHONE X", ip:randomIP()},
  {name:"IPHONE 8", ip:randomIP()},
  {name:"IPHONE 8", ip:randomIP()},
  {name:"IPHONE 7", ip:randomIP()},
  {name:"HAWAWI", ip:randomIP()},
  {name:"A 23 SAMSUNG", ip:randomIP()},
  {name:"SAMSUNG", ip:randomIP()},
  {name:"IPHONE 11", ip:randomIP()},
  {name:"IPHONE 11 PRO MAX", ip:randomIP()},
  {name:"IPHOEN 13 PRO", ip:randomIP()},
  {name:"LG K", ip:randomIP()},
  {name:"Xiaomi redmi", ip:randomIP()},
  {name:"INFINIX", ip:randomIP()}
];
let blockedDevices = [];

function renderDevices(){
  connectedDevicesEl.innerHTML = "";
  connectedDevices.forEach((device, index) => {
    const div = document.createElement("div"); 
    div.className = "device fade-in";
    div.style.animationDelay = `${index * 0.05}s`;

    const header = document.createElement("div"); 
    header.className = "device-header";

    const deviceInfo = document.createElement("div");
    deviceInfo.className = "device-info";
    
    const nameSpan = document.createElement("div"); 
    nameSpan.className = "device-name";
    const deviceIcon = document.createElement("i");
    deviceIcon.className = `fas fa-${getDeviceIcon(device.name)}`;
    nameSpan.appendChild(deviceIcon);
    nameSpan.appendChild(document.createTextNode(device.name));

    const statsDiv = document.createElement("div");
    statsDiv.className = "device-stats";
    statsDiv.innerHTML = `<div class="stat-item"><i class="fas fa-download"></i> Usage: ${randomUsage()}</div>
                          <div class="stat-item"><i class="fas fa-tachometer-alt"></i> Speed: ${randomSpeed()}</div>`;

    deviceInfo.appendChild(nameSpan);
    deviceInfo.appendChild(statsDiv);

    const actionSpan = document.createElement("div"); 
    actionSpan.className = "actions";
    actionSpan.innerHTML = `<button class="block" onclick="blockDevice(${index})"><i class="fas fa-ban"></i> Block</button>
                            <button class="rename" onclick="renameDevice(${index})"><i class="fas fa-edit"></i> Rename</button>`;

    header.appendChild(deviceInfo);
    header.appendChild(actionSpan);

    const ipDiv = document.createElement("div"); 
    ipDiv.className = "device-ip"; 
    ipDiv.innerHTML = `<i class="fas fa-network-wired"></i> IP: ${device.ip}`;

    div.appendChild(header); 
    div.appendChild(ipDiv);
    connectedDevicesEl.appendChild(div);
  });
  
  deviceCountEl.innerHTML = `<i class="fas fa-laptop"></i> Total Connected Devices: ${connectedDevices.length}`;
}

function renderBlocked(){
  blockedDevicesEl.innerHTML = "";
  if(blockedDevices.length===0){
    blockedDevicesEl.innerHTML = `<div style="text-align:center;padding:20px;color:var(--gray)">
    <i class="fas fa-ban" style="font-size:2rem;margin-bottom:10px;"></i><p>No blocked devices</p></div>`;
    return;
  }
  blockedDevices.forEach((device,index)=>{
    const div = document.createElement("div"); 
    div.className = "device blocked-device fade-in";
    div.style.animationDelay = `${index*0.05}s`;
    const header = document.createElement("div"); 
    header.className = "device-header";
    const deviceInfo = document.createElement("div");
    deviceInfo.className = "device-info";
    const nameSpan = document.createElement("div"); 
    nameSpan.className = "device-name";
    const deviceIcon = document.createElement("i");
    deviceIcon.className = `fas fa-${getDeviceIcon(device.name)}`;
    nameSpan.appendChild(deviceIcon);
    nameSpan.appendChild(document.createTextNode(device.name));
    deviceInfo.appendChild(nameSpan);
    const actionSpan = document.createElement("div"); 
    actionSpan.className = "actions";
    actionSpan.innerHTML = `<button class="remove" onclick="removeBlocked(${index})"><i class="fas fa-trash-alt"></i> Remove</button>`;
    header.appendChild(deviceInfo);
    header.appendChild(actionSpan);
    const ipDiv = document.createElement("div"); 
    ipDiv.className = "device-ip"; 
    ipDiv.innerHTML = `<i class="fas fa-network-wired"></i> IP: ${device.ip}`;
    div.appendChild(header); 
    div.appendChild(ipDiv);
    blockedDevicesEl.appendChild(div);
  });
}

// === Actions with Telegram notification ===
function blockDevice(i){ 
  blockedDevices.push(connectedDevices[i]); 
  const deviceName = connectedDevices[i].name;
  connectedDevices.splice(i,1); 
  renderDevices(); 
  renderBlocked(); 
  fetch(`notify.php?msg=Device ${encodeURIComponent(deviceName)} blocked`);
}

function removeBlocked(i){ 
  connectedDevices.push(blockedDevices[i]); 
  const deviceName = blockedDevices[i].name;
  blockedDevices.splice(i,1); 
  renderDevices(); 
  renderBlocked(); 
  fetch(`notify.php?msg=Device ${encodeURIComponent(deviceName)} unblocked`);
}

function renameDevice(i){ 
  const newName = prompt("Enter new device name:", connectedDevices[i].name); 
  if(newName){ 
    connectedDevices[i].name = newName; 
    renderDevices(); 
    fetch(`notify.php?msg=Device renamed to ${encodeURIComponent(newName)}`);
  } 
}

renderDevices();
renderBlocked();
setInterval(renderDevices,5000);

document.addEventListener('click',(e)=>{
  if(mainMenu.classList.contains('active') && 
     !e.target.closest('#mainMenu') && 
     !e.target.closest('#menuToggleBtn')){
    mainMenu.classList.remove('active');
    document.body.style.overflow='';
  }
});
</script>
</body>
</html>
